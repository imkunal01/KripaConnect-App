ğŸ“˜ KRIPA CONNECT â€“ BACKEND DOCUMENTATION
1. Introduction

Kripa Connect is a MERN-based e-commerce platform designed for a local electronics store in Pachore.
The backend system is built using Node.js, Express, and MongoDB, following a modular and scalable architecture.

The backend supports:

Customer shopping & orders

Retailer B2B bulk purchasing

Admin inventory & user management

Analytics dashboards

PDF invoice generation

Secure authentication

Email notifications

The system follows production-grade security and clean separation of concerns.

2. Technology Stack
Layer	Technology
Runtime	Node.js (CommonJS)
Framework	Express.js
Database	MongoDB + Mongoose
Auth	JWT (JSON Web Tokens)
File Uploads	Cloudinary
Emails	Nodemailer
Invoices	pdfkit
Security	helmet, xss-clean, rate-limiter, sanitize
Validation	express-validator
3. Backend Architecture

The backend follows a modular MVC architecture:

src/
 â”£ config/
 â”£ controllers/
 â”£ middleware/
 â”£ models/
 â”£ routes/
 â”£ services/
 â”£ validations/
 â”— server.js


Each module is isolated to maintain clean architecture and scalability.

4. Folder Structure (Detailed)
ğŸ“ controllers/

authController.js â€“ Login/Register, token generation

productController.js â€“ Product CRUD, retailer product list

orderController.js â€“ Customer order placement, history

retailerOrderController.js â€“ Retailer bulk orders

adminController.js â€“ User management (block, delete, roles)

adminOrderController.js â€“ Admin management of orders

analyticsController.js â€“ Revenue, users, sales, low stock

ğŸ“ models/

User.js

Product.js

Order.js

Transaction.js (for online payment future)

Category.js (optional)

ğŸ“ routes/

authRoutes.js

productRoutes.js

orderRoutes.js

retailerRoutes.js

adminRoutes.js

analyticsRoutes.js

invoiceRoutes.js

ğŸ“ middleware/

authMiddleware.js â€“ Protect routes, verify JWT

adminMiddleware.js â€“ Admin-only access

security.js â€“ helmet, rate limiting, xss-clean, sanitization

errorHandler.js â€“ Central error handling

validate.js â€“ express-validator result handler

ğŸ“ services/

emailService.js â€“ Email notifications

cloudinaryService.js â€“ Media uploads

pdfService.js â€“ Invoice PDF generation

invoiceService.js â€“ Full invoice generation â†’ Cloud upload â†’ email

ğŸ“ validations/

authValidations.js

productValidations.js

orderValidations.js

5. Database Models (Simplified)
User Model
name
email
password
role (customer / retailer / admin)
isBlocked
address
createdAt, updatedAt

Product Model
name
description
category
price
retailer_price
price_bulk
min_bulk_qty
images (Cloudinary URLs)
stock
active
createdAt, updatedAt

Order Model
user
items: [ { product, name, qty, price } ]
totalAmount
paymentMethod (COD)
paymentStatus (pending/paid)
deliveryStatus (pending/shipped/delivered/cancelled)
shippingAddress { name, phone, addressLine, city, state, pincode }
razorpay: { order_id, payment_id, signature }
invoiceUrl
createdAt, updatedAt

6. Authentication Flow
âœ” Register

User registers with name, email, password.
Password is hashed using bcrypt.

âœ” Login

JWT is issued with:

{ userId, role }

âœ” Protected Routes

Token validated via middleware.

âœ” Role Based Access

customer â€“ products, cart, orders

retailer â€“ bulk pricing, retailer orders

admin â€“ manage users, products, orders, analytics

7. Admin Features
7.1 User Management

Get all users

Block or unblock user

Delete user

Update roles (customer â†” retailer â†” admin)

Get user stats

7.2 Order Management

View all orders

View retailer-only orders

Update delivery status

Delete orders

8. Product Management

Admin can:

Add product

Update product

Delete / Hide product

Upload images to Cloudinary

Maintain stock

Retailer sees:

Retailer price

Bulk price

Minimum bulk quantity

Customer sees only retail price.

9. Customer Order Flow (COD Only)

User selects products

Adds to cart

Checkout (shipping details)

Order is created with:

paymentMethod = "COD"
paymentStatus = "pending"


Email confirmation sent

Admin updates order status

Invoice can be generated after delivery

10. Retailer B2B Flow (Bulk Pricing System)

Retailer sees special pricing:

retailer_price

price_bulk (if qty â‰¥ min_bulk_qty)

Retailer checkout flow:

Retailer selects bulk quantities

Backend applies bulk pricing logic

Stock is reduced

Retailer order is created

Retailer gets order history

Admin sees retailer-only orders

This allows B2B electronics sales.

11. Invoice System (pdfkit + Cloudinary)
Flow:

Order is created

Invoice generated using pdfkit

Saved temporarily

Uploaded to Cloudinary

URL stored in order

Sent to customer/retailer via email

Invoice includes:

Order ID

User details

Shipping details

Product list

Quantity + price

Total amount

Footer message

12. Analytics Module

Routes:

/overview â†’ total users, orders, revenue

/revenue â†’ day-wise revenue

/orders â†’ order status distribution

/top-products â†’ best sellers

/user-growth â†’ monthly user registrations

/low-stock â†’ products under stock threshold

Used for:

Admin dashboard

Retailer insights (future)

13. Security Implementation
Enabled protections:

helmet â†’ secure headers

rate-limiter â†’ prevents brute force

xss-clean â†’ prevents XSS

mongo-sanitize â†’ prevents injection

cors whitelist â†’ protected domain access

express-validator â†’ request body validation

Error handling:

Central error middleware catches all runtime errors.

14. API Response Format

Every response follows:

{
  success: true/false,
  message: "",
  data: {}
}


This keeps frontend integration simple and consistent.

15. Deployment Preparation

CORS whitelist applied

.env cleaned for production

Logging validated

MongoDB Atlas configured

Cloudinary config added

Nodemailer sender verified

Raw webhook parsing ready for Razorpay integration (future)

16. Future Enhancements (Roadmap)

Razorpay online payments

Wholesaler tier

Return & refund system

AI product recommendation

Push notifications (email/SMS/WhatsApp)

Multi-language support

Delivery tracking API

Loyalty points

17. Conclusion

The backend of Kripa Connect is fully modular, scalable, secure, and production-ready.
It supports both B2C (customer) and B2B (retailer) flows, including bulk pricing, advanced order processing, analytics, and invoice automation.

The backend is aligned with:

Clean code practices

Separation of concerns

Enterprise design patterns

High security standards

This backend serves as a strong foundation for the frontend and future expansion of Kripa Connect.